<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <script src="./lib/p5.min.js"></script>
    <script src="./lib/p5.sound.min.js"></script>
    <script src="./lib/p5.speech.js"></script>
</head>

<body>

    <script type="text/javascript">

        var intros = [], clues = [], finalSample, wrongSample;
        var globalIndex = -1;
        var clueCounter = 0;
        var speech;
        var nextButton, prevButton, clueButton;

        function preload() {
            for (let i = 0; i < 4; i++) {
                intros[i] = loadSound("./Audio/intro" + i + ".wav");
                clues[i] = loadSound("./Audio/clue" + i + ".wav");
            }
            finalSample = loadSound("./Audio/finalSample.wav");
            wrongSample = loadSound("./Audio/wrongSample.wav");

        }

        function setup() {
            nextButton = createButton("NEXT");
            nextButton.mousePressed(playNext);
            prevButton = createButton("PREV");
            prevButton.mousePressed(playPrev);
            clueButton = createCheckbox("CLUE", false);
            clueButton.changed(clueOrInput);
            speech = new p5.SpeechRec();
            speech.onResult = speechFinished;
        }

        function draw() {

        }

        function playNext() {
            globalIndex++;
            if (globalIndex > intros.length - 1)
                globalIndex = intros.length - 1;
            intros[globalIndex].play();
        }

        function playPrev() {
            globalIndex--;
            if (globalIndex < 0)
                globalIndex = 0;
            intros[globalIndex].play();
        }

        function clueOrInput() {
            let check;
            if (clueButton.checked()) {
                clueCounter = 0;
                check = setInterval(() => {
                    clueCounter++;
                    if (clueCounter == 10) {
                        clearInterval(check);
                        speech.start();
                    }
                }, 100)

            }
            else {
                clearInterval(check);
                if (clueCounter < 10)
                    clues[globalIndex].play();
            }
        }

        function speechFinished() {
            let data = speech.resultString.toUpperCase();
            if (data.includes("RING") && data.includes("ENGINE")) {
                finalSample.play();
            }
            else {
                wrongSample.play();
            }
        }
    </script>

</body>

</html>