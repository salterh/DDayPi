<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
</head>

<body>
    <script type="text/javascript">
        var audiocontext = new AudioContext();
        var baseLayersElement = [], baseLayersSample = [], baseLayerCount = 4;
        var oneShotsElement = [], oneShotsSample = [], oneShotPool = [], oneShotCount = 4;
        var convo0Element = [], convo0Sample = [], convoCount = 3, convo1Element = [], convo1Sample = [], convo1Count = 4;
        var chance = 10;
        var time = 2000;

        preload();

        function preload() {
            for (let i = 0; i < baseLayerCount; i++) {
                baseLayersElement[i] = document.createElement('audio');
                baseLayersElement[i].src = './Audio/baseLayer' + i + '.wav';
                baseLayersElement[i].loop = true;
                baseLayersSample[i] = audiocontext.createMediaElementSource(baseLayersElement[i]);
            }
            for (let i = 0; i < oneShotCount; i++) {
                oneShotsElement[i] = document.createElement('audio');
                oneShotsElement[i].src = './Audio/oneShot' + i + '.wav';
                oneShotsSample[i] = audiocontext.createMediaElementSource(oneShotsElement[i]);
            }
            for (let i = 0; i < convo0Count; i++) {
                convo0Element[i] = document.createElement('audio');
                convo0Element[i].src = './Audio/convo0Line' + i + '.ogg'
                convo0Sample[i] = audiocontext.createMediaElementSource(convo0Element[i]);
            }
            for (let i = 0; i < convo1Count; i++) {
                convo1Element[i] = document.createElement('audio');
                convo1Element[i].src = './Audio/convo1Line' + i + '.ogg'
                convo1Sample[i] = audiocontext.createMediaElementSource(convo1Element[i]);
            }
            
            oneShotPool = [...oneShotsElement];
            Tone.loaded().then(() => {
                for (let i = 0; i < baseLayers.length; i++)
                    baseLayersElement[i].play();
                setTimeout(playRandomSound, time);
                beginConvo();
            });
        }
        function playRandomSound() {
            if (oneShotPool.length > 0)
                if (Math.random() * 100 < chance) {
                    let randomIndex = Math.floor(Math.random() * oneShotPool.length);
                    oneShotPool[randomIndex].play();
                    oneShotPool.splice(randomIndex, 1);
                }
                else
                    oneShotPool = [...oneShotsElement];
            setTimeout(playRandomSound, time);
        }

        function beginConvo() {

        }

    </script>
</body>

</html>